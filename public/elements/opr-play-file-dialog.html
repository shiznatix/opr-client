<dom-module id="opr-play-file-dialog">
	<template>
		<style include="opr-shared-styles"></style>

		<iron-ajax
			id="currentPlaylistAjax"
			url="/current-playlist"
			handle-as="json"
			last-response="{{ajaxResponse}}"
			on-response="handleResponse">
		</iron-ajax>

		<paper-dialog
			entry-animation="scale-up-animation"
			exit-animation="fade-out-animation"
			id="playFileDialog">

			<h2>Play file</h2>

			<paper-spinner active id="playFileLoadingSpinner"></paper-spinner>

			<paper-radio-group on-change="indexOnChange" id="indexRadio" attr-for-selected="value">
				<template is="dom-repeat" items="[[ajaxResponse.data]]">
					<paper-radio-button value="[[index]]">[[item.fileName]]</paper-radio-button>
					<br />
				</template>
			</paper-radio-group>

			<div class="dialogButtons">
				<paper-button dialog-dismiss>Cancel</paper-button>
				<paper-button dialog-confirm disabled id="playButton" on-tap="playPressed">Play</paper-button>
			</div>
		</paper-dialog>
	</template>
	<script>
		Polymer({
			is: 'opr-play-file-dialog',

			selectedIndex: -1,
			playIndexCallback: null,

			clearSelectedIndex: function() {
				this.$.indexRadio.select(-1);
				this.selectedIndex = -1;
				this.$.playButton.disabled = true;
			},

			open: function(playIndexCallback) {
				this.playIndexCallback = playIndexCallback;
				this.clearSelectedIndex();
				this.$.indexRadio.hidden = true;
				this.$.playFileLoadingSpinner.hidden = false;
				this.$.playFileDialog.open();
				this.$.currentPlaylistAjax.generateRequest();
			},

			handleResponse: function() {
				this.clearSelectedIndex();
				this.$.indexRadio.hidden = false;
				this.$.playFileLoadingSpinner.hidden = true;
			},

			indexOnChange: function(e) {
				const target = e.target;

				this.selectedIndex = target.value;
				this.$.playButton.disabled = false;
			},

			playPressed: function(e) {
				if (this.selectedIndex < 0) {
					return;
				}

				this.playIndexCallback(this.selectedIndex);
			},
		});
	</script>
</dom-module>