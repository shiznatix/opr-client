<dom-module id="opr-random-settings">
	<template>
		<style include="opr-shared-styles">
		</style>

		<iron-location path="{{path}}"></iron-location>

		<iron-ajax
			id="randomSettingsAjax"
			url="/shows"
			handle-as="json"
			last-response="{{ajaxResponse}}">
		</iron-ajax>

		<iron-accordions id="showCategoryAccordions">
			<template is="dom-repeat" items="[[ajaxResponse.data]]">
				<iron-accordion>
					<h2 header>[[item.categoryName]]</h2>

					<div class="roundedContainer">
						<template is="dom-repeat" items="[[item.shows]]">
							<div class="listEntry">
								<paper-checkbox value="[[item]]" on-change="checkboxChanged" checked="{{checkboxChecked(item)}}">[[item]]</paper-checkbox>
							</div>
						</template>
					</div>
				</iron-accordion>
			</template>
		</iron-accordions>
	</template>
	<script>
		Polymer({
			is: 'opr-random-settings',

			savedShowNames: [],

			properties: {
				path: {
					type: String,
					observer: 'pathChanged',
				},
			},

			pathChanged: function() {
				if ('/random-settings' === this.path) {
					this.reload();
				}
			},

			ready: function() {
				try {
					this.savedShowNames = JSON.parse(localStorage.getItem('randomShows'));
				} catch (e) {
				}

				this.savedShowNames = (Array.isArray(this.savedShowNames) ? this.savedShowNames : []);
			},

			reload: function() {
				this.$.randomSettingsAjax.generateRequest();
			},

			checkboxChecked: function(showName) {
				return (this.savedShowNames.indexOf(showName) > -1 ? 'checked' : '');
			},

			checkboxChanged: function(event) {
				const showName = event.target.value,
					checked = event.target.checked,
					index = this.savedShowNames.indexOf(showName);

				if (!checked && index > -1) {
					this.savedShowNames.splice(index, 1);
					localStorage.setItem('randomShows', JSON.stringify(this.savedShowNames));
				} else if (checked && -1 === index) {
					this.savedShowNames.push(showName);
					localStorage.setItem('randomShows', JSON.stringify(this.savedShowNames));
				}
			},
		});
	</script>
</dom-module>